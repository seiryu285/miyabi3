<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MIYABI - Japanese Art NFT Collection | Gallery</title>
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500&display=swap" rel="stylesheet">
  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: "Yu Mincho", "YuMincho", serif;
      background-color: #ffffff;
      overflow-x: hidden;
      color: #333;
      forced-color-adjust: none;
    }
    /* Navigation (for gallery page) */
    .nav {
      position: fixed;
      top: 30px;
      right: 50px;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 30px;
    }
    .nav a {
      color: white;
      text-decoration: none;
      font-size: 18px;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
    }
    .nav a:hover {
      color: #FFD700;
    }
    /* 言語選択タブの背景・境界線 */
    .nav .lang-select {
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.5);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-family: 'Rajdhani', sans-serif;
      cursor: pointer;
    }
    .nav .connect-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 20px;
      border-radius: 4px;
      font-family: 'Rajdhani', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .nav .connect-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    /* Gallery container */
    .gallery-container {
      padding: 2rem;
      margin-top: 140px;
      background-color: #ffffff;
    }
    /* ギャラリーのグリッド */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .gallery-item {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .gallery-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }
    .gallery-item img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }
    .gallery-item-number {
      position: absolute;
      top: 1rem;
      left: 1rem;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.875rem;
      color: #fff;
      background: rgba(0, 0, 0, 0.5);
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      z-index: 2;
    }
    /* NFT Detail Modal */
    .nft-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: all 0.3s ease;
    }
    .nft-modal::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: -1;
    }
    .modal-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      transition: background-color 0.3s ease;
      z-index: -2;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      display: none;
    }
    @media (max-width: 768px) {
      .modal-overlay {
        display: block;
      }
    }
    .nft-modal.active {
      opacity: 1;
      display: flex;
    }
    .modal-content {
      position: relative;
      width: 95%;
      max-width: 1400px;
      height: 90vh;
      display: flex;
      color: #ffffff;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 24px;
      overflow: hidden;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    /* Fullscreen for video on mobile */
    @media (max-width: 768px) {
      .modal-content.video-active {
        width: 100vw;
        height: 100vh;
        border-radius: 0;
      }
      .modal-content.video-active .modal-info {
        display: none;
      }
      .modal-content.video-active .modal-image video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        border-radius: 0;
      }
    }
    /* Desktop optimization for video */
    @media (min-width: 769px) {
      .modal-content.video-active {
        width: 90%;
        height: 80vh;
        border-radius: 12px;
        margin: auto;
      }
      .modal-content.video-active .modal-info {
        display: none;
      }
      .modal-content.video-active .modal-image video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 12px;
      }
    }
    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: transparent;
      border: none;
      color: #fff;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.3s ease;
      z-index: 100;
      padding: 0;
      line-height: 1;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    @media (hover: hover) and (pointer: fine) {
      .modal-close:hover {
        color: #FFD700;
      }
    }
    .modal-inner {
      display: flex;
      width: 100%;
      height: 100%;
      gap: 2rem;
      padding: 1.5rem;
    }
    .modal-image {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      max-height: 100%;
      padding: 1rem;
      position: relative;
    }
    .modal-image img,
    .modal-image video {
      max-width: 100%;
      max-height: 85vh;
      object-fit: contain;
      border-radius: 16px;
    }
    /* Note: video tag does not include controls attribute so no native UI is shown */
    .modal-info {
      width: 400px;
      height: 100%;
      padding: 1.5rem;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .collection-row {
      font-family: 'Rajdhani', sans-serif;
      font-size: 1rem;
      letter-spacing: 0.5px;
      opacity: 0.9;
      margin-bottom: 0.75rem;
    }
    .modal-title {
      font-size: 2rem;
      line-height: 1.3;
      font-weight: 600;
      margin-bottom: 1.5rem;
    }
    .modal-description {
      line-height: 1.8;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      white-space: pre-line;
      margin-bottom: 2rem;
    }
    .modal-traits {
      margin-bottom: 2rem;
    }
    .modal-traits h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    .trait-item {
      margin-bottom: 0.75rem;
      font-size: 1rem;
    }
    .trait-type {
      font-weight: 500;
      opacity: 0.8;
    }
    .modal-details {
      font-size: 1rem;
    }
    .detail-item {
      margin-bottom: 0.75rem;
    }
    .detail-label {
      opacity: 0.8;
    }
    .modal-info::-webkit-scrollbar {
      width: 8px;
    }
    .modal-info::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    .modal-info::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }
    .modal-info::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    @media (max-width: 1024px) {
      .modal-inner {
        flex-direction: column;
        gap: 1.5rem;
      }
      .modal-info {
        width: 100%;
        max-height: 50vh;
      }
      .modal-image {
        padding: 0;
      }
      .modal-image img,
      .modal-image video {
        max-height: 40vh;
      }
      .modal-title {
        font-size: 1.75rem;
      }
      .modal-description {
        font-size: 1rem;
      }
    }
    @media (max-width: 768px) {
      .nav {
        right: 20px;
        top: 20px;
        gap: 15px;
      }
      .gallery-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
      .nft-modal {
        padding: 1rem;
      }
      .modal-content {
        height: 100vh;
        width: 100vw;
        border-radius: 0;
      }
      .modal-inner {
        padding: 1rem;
        gap: 1rem;
      }
      .modal-close {
        top: 1rem;
        right: 1rem;
        width: 36px;
        height: 36px;
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <select class="lang-select">
      <option value="ja">JP</option>
      <option value="en" selected>EN</option>
    </select>
    <button class="connect-btn" data-translate="connectWallet">CONNECT</button>
    <!-- 追加：没入体験へ移動するタブ -->
    <a href="immersive.html" data-translate="enterWorld">ENTER</a>
    <a href="gallery.html" class="gallery-link" data-translate="gallery">VIEW GALLERY</a>
    <a href="about.html" data-translate="about">ABOUT</a>
  </nav>

  <!-- Gallery Container -->
  <div class="gallery-container">
    <div class="gallery-grid">
      <!-- NFT items are生成 via JS -->
    </div>
  </div>

  <!-- NFT Detail Modal -->
  <div class="nft-modal" id="nftModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-background"></div>
      <button class="modal-close">×</button>
      <div class="modal-inner">
        <div class="modal-image">
          <!-- 初期表示は画像、動画は非表示 -->
          <img id="modalImage" src="" alt="NFT Detail">
          <video id="modalVideo" style="display: none;" playsinline></video>
        </div>
        <div class="modal-info">
          <div class="modal-header">
            <div class="collection-row">
              <span class="collection-label" id="modalCollection"></span>
              <span id="modalNumber"></span>
            </div>
            <h2 class="modal-title" id="modalTitle"></h2>
          </div>
          <div class="modal-description" id="modalDescription"></div>
          <div class="modal-traits" id="modalTraits"></div>
          <div class="modal-details">
            <div class="detail-item">
              <span class="detail-label" data-translate="details.style">Style:</span>
              <span class="detail-value" id="modalStyle"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label" data-translate="details.method">Method:</span>
              <span class="detail-value" id="modalMethod"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label" data-translate="details.accessory">Accessory:</span>
              <span class="detail-value" id="modalAccessory"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Web3 Library -->
  <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  <!-- Color Thief Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
  <script>
    // 翻訳用オブジェクト
    const translations = {
      en: {
        connectWallet: "CONNECT",
        gallery: "VIEW GALLERY",
        about: "ABOUT",
        enterWorld: "ENTER",
        search: "Search by name or number...",
        ui: {
          all: "All",
          recent: "Recent",
          popular: "Popular",
          trending: "Trending"
        },
        details: {
          style: "Style:",
          method: "Method:",
          accessory: "Accessory:"
        },
        traitsTitle: "Traits"
      },
      ja: {
        connectWallet: "ウォレット接続",
        gallery: "ギャラリーを見る",
        about: "このプロジェクトについて",
        enterWorld: "没入体験",
        search: "名前または番号で検索...",
        ui: {
          all: "すべて",
          recent: "新着",
          popular: "人気",
          trending: "トレンド"
        },
        details: {
          style: "スタイル:",
          method: "制作技法:",
          accessory: "装飾:"
        },
        traitsTitle: "特性"
      }
    };

    let currentLang = "en";

    document.addEventListener('DOMContentLoaded', function() {
      // NFTデータ定義 (#1～#30)
      // ※以下は一例です。各キャラクターの traits には英語版と日本語版の値を追加してください。
      const nftData = [
        {
          id: 1,
          title: "MIYABI #001: Aonami - The Inheritor of Ripples",
          description_en: "Aonami, hailing from a lineage of Kamakura textile artisans, upholds the ancient art of indigo dyeing. Calm as a deep ocean, he channels a fervent passion to fuse digital art with traditional techniques.",
          description_ja: "青波は鎌倉の染織職人の家系に生まれ、古来の藍染技法を受け継いでいます。深海のような静けさを持ちながら、デジタルアートと伝統技法の融合に情熱を注ぐ。",
          image: "assets/nft1.jpg",
          video: "assets/nft1.mp4",
          style: "Contemporary Shibori",
          method: "Digital Painting & Dyeing Fusion",
          accessory: "Kimono with Wave Pattern",
          collection: "MIYABI",
          traits: {
            personality_en: "Calm & Passionate",
            personality_ja: "穏やかで情熱的",
            specialty_en: "Indigo Dyeing",
            specialty_ja: "藍染",
            currentBase_en: "Tokyo",
            currentBase_ja: "東京",
            fourCharacterIdiom_en: "Aosio Dream Rhyme",
            fourCharacterIdiom_ja: "青藍夢韻"
          }
        },
        // #2～#10 のデータ（各 traits も同様に英語版/日本語版を追加）
        {
          id: 2,
          title: "MIYABI #002: Kakurin - The Swordmaster of Tradition",
          description_en: "Kakurin, descendant of a samurai lineage bearing the crane emblem, has been trained in swordsmanship since childhood.",
          description_ja: "鶴凛は鶴の家紋を持つ武家の末裔で、幼少より剣の修行を積んでいる。",
          image: "assets/nft2.jpg",
          video: "",
          style: "Samurai Urban",
          method: "Traditional Swordsmanship + Modern Security",
          accessory: "Crane Emblem",
          collection: "MIYABI",
          traits: {
            personality_en: "Polite & Proud",
            personality_ja: "礼儀正しく誇り高い",
            specialty_en: "Swordsmanship",
            specialty_ja: "剣術",
            currentBase_en: "Metropolis",
            currentBase_ja: "大都市",
            fourCharacterIdiom_en: "Crane Shadow Blade",
            fourCharacterIdiom_ja: "鶴影剣"
          }
        },
        // #3～#10 も同様に記述（省略）
        {
          id: 3,
          title: "MIYABI #003: Shiki",
          description_en: "Shiki transforms nature's hues into stunning textile art, reflecting the timeless elegance of nature.",
          description_ja: "四季は自然の色彩を見事なテキスタイルアートへ昇華させ、永遠の優雅さを映し出す。",
          image: "assets/nft3.jpg",
          video: "assets/nft3.mp4",
          style: "Seasonal",
          method: "Digital Painting + Textile Fusion",
          accessory: "Floral Motifs",
          collection: "MIYABI",
          traits: {
            personality_en: "Elegant & Sensitive",
            personality_ja: "優雅で繊細",
            specialty_en: "Textile Art",
            specialty_ja: "テキスタイルアート",
            currentBase_en: "Multiple Bases",
            currentBase_ja: "複数の拠点",
            fourCharacterIdiom_en: "Colorful Seasonal Tour",
            fourCharacterIdiom_ja: "彩季巡礼"
          }
        },
        {
          id: 4,
          title: "MIYABI #004: Gadō",
          description_en: "Gadō, a swordsman with a cybernetic limb, fuses traditional swordsmanship with futuristic technology.",
          description_ja: "牙堂はサイバー義足を装着し、伝統的な剣術と未来技術を融合させた戦士。",
          image: "assets/nft4.jpg",
          video: "assets/nft4.mp4",
          style: "Cybernetic Street",
          method: "Cyber Limb Acceleration",
          accessory: "Mechanical Leg",
          collection: "MIYABI",
          traits: {
            personality_en: "Rugged & Just",
            personality_ja: "荒々しくも正義感が強い",
            specialty_en: "Accelerated Swordsmanship",
            specialty_ja: "加速した剣術",
            currentBase_en: "City Center",
            currentBase_ja: "市中心",
            fourCharacterIdiom_en: "Machine Limb Steel",
            fourCharacterIdiom_ja: "機械義足鋼"
          }
        },
        {
          id: 5,
          title: "MIYABI #005: Kamari - The Innovator of Blossoms",
          description_en: "Kamari uses biotechnology to create new blossoms, bridging ancient methods with futuristic techniques.",
          description_ja: "華鞠はバイオテクノロジーで新たな花を創り出し、古来の秘法と未来技術を融合させる。",
          image: "assets/nft5.jpg",
          video: "assets/nft5.mp4",
          style: "Floral & Biotech",
          method: "Genetic Engineering + Floral Art",
          accessory: "Special Bio Flower",
          collection: "MIYABI",
          traits: {
            personality_en: "Graceful & Passionate",
            personality_ja: "優雅で情熱的",
            specialty_en: "Floral Creation",
            specialty_ja: "花の創造",
            currentBase_en: "Research Institute",
            currentBase_ja: "研究所",
            fourCharacterIdiom_en: "Floral Dream Color",
            fourCharacterIdiom_ja: "花夢色彩"
          }
        },
        {
          id: 6,
          title: "MIYABI #006: Tsudzune",
          description_en: "Tsudzune blends traditional instruments with modern electronic music, captivating a global audience.",
          description_ja: "鼓音は伝統楽器と最新電子音楽を融合させ、世界中を魅了する。",
          image: "assets/nft6.jpg",
          video: "assets/nft6.mp4",
          style: "Traditional Instruments x EDM",
          method: "Digital Sampler + Live Performance",
          accessory: "Drum & Shamisen",
          collection: "MIYABI",
          traits: {
            personality_en: "Cheerful & Passionate",
            personality_ja: "明るく情熱的",
            specialty_en: "Music Fusion",
            specialty_ja: "音楽の融合",
            currentBase_en: "SNS World",
            currentBase_ja: "SNS",
            fourCharacterIdiom_en: "Drum Sound Rhythm",
            fourCharacterIdiom_ja: "鼓律韻律"
          }
        },
        {
          id: 7,
          title: "MIYABI #007: Kōka",
          description_en: "Kōka captivates the world with avant-garde collections after mastering the art of crimson dyeing.",
          description_ja: "紅霞は紅染技法を極め、前衛的なコレクションで世界を魅了する。",
          image: "assets/nft7.jpg",
          video: "assets/nft7.mp4",
          style: "Crimson Dye Fashion",
          method: "Traditional Dyeing + Avant-Garde Design",
          accessory: "Red Embellishments",
          collection: "MIYABI",
          traits: {
            personality_en: "Perfectionist & Elegant",
            personality_ja: "完璧主義で優雅",
            specialty_en: "Crimson Dyeing",
            specialty_ja: "紅染",
            currentBase_en: "Tokyo",
            currentBase_ja: "東京",
            fourCharacterIdiom_en: "Crimson Radiance",
            fourCharacterIdiom_ja: "紅輝煌然"
          }
        },
        {
          id: 8,
          title: "MIYABI #008: Hakuga",
          description_en: "Hakuga, born with albinism, is a stealthy assassin trained by a ninja clan.",
          description_ja: "白牙はアルビノで、忍者集団で鍛えられた暗殺者。",
          image: "assets/nft8.jpg",
          video: "assets/nft8.mp4",
          style: "Albinistic Ninja",
          method: "Assassination Techniques + Stealth Attire",
          accessory: "White Hair & Garb",
          collection: "MIYABI",
          traits: {
            personality_en: "Taciturn & Cold",
            personality_ja: "無口で冷淡",
            specialty_en: "Covert Operations",
            specialty_ja: "隠密行動",
            currentBase_en: "Underworld",
            currentBase_ja: "裏社会",
            fourCharacterIdiom_en: "White Hunt Shadow",
            fourCharacterIdiom_ja: "白狩影"
          }
        },
        {
          id: 9,
          title: "MIYABI #009: Yūmen",
          description_en: "Yūmen pioneers a new mask culture by blending traditional craftsmanship with digital innovation.",
          description_ja: "幽面は伝統工芸とデジタル革新を融合し、新たな仮面文化を切り拓く。",
          image: "assets/nft9.jpg",
          video: "assets/nft9.mp4",
          style: "Noh Mask x AR",
          method: "Wood Carving + Digital Projection",
          accessory: "Various Masks",
          collection: "MIYABI",
          traits: {
            personality_en: "Mysterious & Introspective",
            personality_ja: "神秘的で内省的",
            specialty_en: "Spiritual Visualization",
            specialty_ja: "霊的表現",
            currentBase_en: "Unknown",
            currentBase_ja: "不明",
            fourCharacterIdiom_en: "Mysterious Mask Time",
            fourCharacterIdiom_ja: "仮面時雨"
          }
        },
        {
          id: 10,
          title: "MIYABI #010: Shura",
          description_en: "Shura, a lone warrior of a fallen samurai lineage, charges down the 'path of Ashura' in his self-crafted crimson cyber-armor.",
          description_ja: "修羅は没落した武家の末裔で、独自の紅いサイバーアーマーを纏い『修羅の道』を突き進む。",
          image: "assets/nft10.jpg",
          video: "assets/nft10.mp4",
          style: "Fallen Samurai x Cyber Armor",
          method: "Self-Crafted Armor + Swordplay",
          accessory: "Crimson Armor",
          collection: "MIYABI",
          traits: {
            personality_en: "Fierce & Lone",
            personality_ja: "激しく孤高",
            specialty_en: "Intense Combat",
            specialty_ja: "激戦",
            currentBase_en: "Ruins",
            currentBase_ja: "廃墟",
            fourCharacterIdiom_en: "Shura Crimson Armor",
            fourCharacterIdiom_ja: "修羅紅衣"
          }
        },
        // 以下、#011～#030 のデータ（各 traits も英語版・日本語版を用意）
        {
          id: 11,
          title: "MIYABI #011: 千流 (Senryu)",
          description_en: "Senryu bridges tradition and innovation by absorbing diverse cultural essences to create new MIYABI forms. His ever-evolving work epitomizes adaptability.",
          description_ja: "千流は伝統と革新を繋ぎ、多様な文化のエッセンスを取り入れて新たなMIYABIを創造、その作品は柔軟に変化し続ける。",
          image: "assets/nft11.jpg",
          video: "",
          style_en: "Fusion of Cultures",
          style_ja: "多文化の融合",
          method_en: "Traditional + Digital Art Fusion",
          method_ja: "伝統とデジタルアートの融合",
          accessory_en: "Dynamic Brushstrokes",
          accessory_ja: "ダイナミックな筆致",
          collection: "MIYABI",
          traits: {
            personality_en: "Flexible & Original",
            personality_ja: "柔軟で独創的",
            specialty_en: "Fusion of Various Arts",
            specialty_ja: "多様な芸術の融合",
            currentBase_en: "Global",
            currentBase_ja: "グローバル",
            fourCharacterIdiom_en: "Senpen Banka",
            fourCharacterIdiom_ja: "千変万化"
          }
        },
        {
          id: 12,
          title: "MIYABI #012: 煌牙 (Koga)",
          description_en: "Koga merges digital aesthetics with traditional Japanese art. His cyber-inspired designs radiate dazzling brilliance.",
          description_ja: "煌牙はデジタル美学と伝統的な日本美を融合させ、サイバー調のデザインがまばゆい輝きを放つ。",
          image: "assets/nft12.jpg",
          video: "",
          style_en: "Cyber Fusion",
          style_ja: "サイバーフュージョン",
          method_en: "Digital Art + Traditional Techniques",
          method_ja: "デジタルアートと伝統技法の融合",
          accessory_en: "Luminescent Accents",
          accessory_ja: "光彩のアクセント",
          collection: "MIYABI",
          traits: {
            personality_en: "Innovative & Passionate",
            personality_ja: "革新的で情熱的",
            specialty_en: "Digital & Traditional Fusion",
            specialty_ja: "デジタルと伝統の融合",
            currentBase_en: "Global",
            currentBase_ja: "グローバル",
            fourCharacterIdiom_en: "Kōki Sanzen",
            fourCharacterIdiom_ja: "光輝燦然"
          }
        },
        {
          id: 13,
          title: "MIYABI #013: 影牙 (Eiga)",
          description_en: "Eiga, a secret guardian and ninja descendant, fuses ancient ninjutsu with modern technology.",
          description_ja: "忍の末裔である影牙は、古来の忍術と最新技術を融合して敵に静かに迫る。",
          image: "assets/nft13.jpg",
          video: "",
          style_en: "Stealth Combat",
          style_ja: "ステルス戦闘",
          method_en: "Ninjutsu + Modern Tech",
          method_ja: "忍術と最新技術の融合",
          accessory_en: "Concealed Blade",
          accessory_ja: "隠し刃",
          collection: "MIYABI",
          traits: {
            personality_en: "Calm & Calculated",
            personality_ja: "冷静かつ計算高い",
            specialty_en: "Stealth & Combat",
            specialty_ja: "隠密と戦闘",
            currentBase_en: "Urban Shadows",
            currentBase_ja: "都市の闇",
            fourCharacterIdiom_en: "Eion Ninjin",
            fourCharacterIdiom_ja: "影隠忍刃"
          }
        },
        {
          id: 14,
          title: "MIYABI #014: 幽練 (Yuren)",
          description_en: "Yuren channels spiritual power through his masks, revealing the soul of its wearer.",
          description_ja: "幽練は仮面を通して霊的な力を引き出し、着用者の魂を映し出す。",
          image: "assets/nft14.jpg",
          video: "",
          style_en: "Spiritual Craft",
          style_ja: "霊的工芸",
          method_en: "Traditional Mask Making + Digital Expression",
          method_ja: "伝統的な能面制作とデジタル表現",
          accessory_en: "Mystic Mask",
          accessory_ja: "神秘の仮面",
          collection: "MIYABI",
          traits: {
            personality_en: "Quiet & Mysterious",
            personality_ja: "静かで神秘的",
            specialty_en: "Noh Mask & Spirit Art",
            specialty_ja: "能面と霊的表現",
            currentBase_en: "Ancient City",
            currentBase_ja: "古都",
            fourCharacterIdiom_en: "Yūgen Shinpi",
            fourCharacterIdiom_ja: "幽玄神秘"
          }
        },
        {
          id: 15,
          title: "MIYABI #015: 白菊 (Shiragiku)",
          description_en: "Shiragiku, descendant of a noble lineage preserving court culture, conceals a warrior’s spirit beneath serene dignity.",
          description_ja: "白菊は宮廷文化と武術を継承する一族の末裔で、静謐な佇まいの中に戦士の精神を秘めてる。",
          image: "assets/nft15.jpg",
          video: "",
          style_en: "Court Elegance",
          style_ja: "宮廷の優雅さ",
          method_en: "Ancient Chanting & Martial Control",
          method_ja: "古代詠唱と精神操作武術",
          accessory_en: "Ornate Fan",
          accessory_ja: "装飾的な扇子",
          collection: "MIYABI",
          traits: {
            personality_en: "Serene & Noble",
            personality_ja: "穏やかで気高い",
            specialty_en: "Ancient Chanting",
            specialty_ja: "古代詠唱",
            currentBase_en: "Royal Grounds",
            currentBase_ja: "王宮",
            fourCharacterIdiom_en: "Kokou Gashin",
            fourCharacterIdiom_ja: "孤高雅心"
          }
        },
        {
          id: 16,
          title: "MIYABI #016: 紅蓮 (Kurenai)",
          description_en: "Kurenai dazzles with brilliance and merges court dance with martial arts.",
          description_ja: "紅蓮は華やかな輝きと武舞を融合させた存在。",
          image: "assets/nft16.jpg",
          video: "",
          style_en: "Martial Dance",
          style_ja: "武舞",
          method_en: "Court Dance + Martial Arts",
          method_ja: "宮廷舞踊と武術の融合",
          accessory_en: "Ceremonial Adornments",
          accessory_ja: "儀式用装飾",
          collection: "MIYABI",
          traits: {
            personality_en: "Elegant & Fierce",
            personality_ja: "優雅で激しい",
            specialty_en: "Dance Combat",
            specialty_ja: "舞踏戦闘",
            currentBase_en: "Ceremonial Halls",
            currentBase_ja: "儀式の間",
            fourCharacterIdiom_en: "Rekka Sanzen",
            fourCharacterIdiom_ja: "烈華燦然"
          }
        },
        {
          id: 17,
          title: "MIYABI #017: 黒薔薇 (Kurobara)",
          description_en: "Kurobara blends mystical beauty with dangerous allure, subduing foes without physical combat.",
          description_ja: "黒薔薇は神秘的な美と危険な魅力を併せ持ち、戦わずして相手を幻惑する。",
          image: "assets/nft17.jpg",
          video: "",
          style_en: "Illusory Art",
          style_ja: "幻影の芸術",
          method_en: "Enchantment & Dark Tactics",
          method_ja: "幻惑と闇戦術",
          accessory_en: "Obscure Emblem",
          accessory_ja: "不明瞭な紋章",
          collection: "MIYABI",
          traits: {
            personality_en: "Mysterious & Alluring",
            personality_ja: "神秘的で魅惑的",
            specialty_en: "Illusion & Enchantment",
            specialty_ja: "幻影と魅了",
            currentBase_en: "Shadow Realm",
            currentBase_ja: "影の界",
            fourCharacterIdiom_en: "Yūen Yōka",
            fourCharacterIdiom_ja: "幽艶妖華"
          }
        },
        {
          id: 18,
          title: "MIYABI #018: 蒼牙 (Souga)",
          description_en: "Souga seeks perfection in traditional martial arts while reflecting on the nature of battle.",
          description_ja: "蒼牙は伝統武術の極致を求めながら、戦いの意味について内省する求道者。",
          image: "assets/nft18.jpg",
          video: "",
          style_en: "Swordsmanship Philosophy",
          style_ja: "剣道哲学",
          method_en: "Traditional Swordplay + Reflective Combat",
          method_ja: "古流剣術と反省的戦闘の融合",
          accessory_en: "Ancient Sword",
          accessory_ja: "古代の剣",
          collection: "MIYABI",
          traits: {
            personality_en: "Determined & Thoughtful",
            personality_ja: "決意に満ち思慮深い",
            specialty_en: "Classical Swordsmanship",
            specialty_ja: "古典的剣術",
            currentBase_en: "Ancient Dojo",
            currentBase_ja: "古流道場",
            fourCharacterIdiom_en: "Gōjū Sōsai",
            fourCharacterIdiom_ja: "剛柔相済"
          }
        },
        {
          id: 19,
          title: "MIYABI #019: 翠流 (Suiryu)",
          description_en: "Suiryu cherishes silence and masters the fluid art of water and wind.",
          description_ja: "翠流は静寂を愛し、水と風の流動美を極める。",
          image: "assets/nft19.jpg",
          video: "",
          style_en: "Fluid Aesthetics",
          style_ja: "流動美",
          method_en: "Art of Water & Wind",
          method_ja: "水と風の芸術",
          accessory_en: "Flowing Garb",
          accessory_ja: "流れる衣装",
          collection: "MIYABI",
          traits: {
            personality_en: "Contemplative & Calm",
            personality_ja: "内省的で穏やか",
            specialty_en: "Fluid Art",
            specialty_ja: "流動的な芸術",
            currentBase_en: "Wandering",
            currentBase_ja: "放浪",
            fourCharacterIdiom_en: "Seikan Ryuusui",
            fourCharacterIdiom_ja: "静観流水"
          }
        },
        {
          id: 20,
          title: "MIYABI #020: 紅蓮 (Guren)",
          description_en: "Guren is a passionate performer specializing in flame dance and tactical aesthetics.",
          description_ja: "紅蓮は情熱的な舞踏家で、炎の舞と戦術美学を極める。",
          image: "assets/nft20.jpg",
          video: "",
          style_en: "Flame Dance",
          style_ja: "炎の舞",
          method_en: "Tactical Aesthetics + Dance",
          method_ja: "戦術美学と舞踏の融合",
          accessory_en: "Fiery Adornments",
          accessory_ja: "炎の装飾",
          collection: "MIYABI",
          traits: {
            personality_en: "Passionate & Fearless",
            personality_ja: "情熱的で大胆",
            specialty_en: "Flame Dance",
            specialty_ja: "炎の舞踏",
            currentBase_en: "Global",
            currentBase_ja: "世界各地",
            fourCharacterIdiom_en: "Nentō Buei",
            fourCharacterIdiom_ja: "燃燈舞影"
          }
        },
        {
          id: 21,
          title: "MIYABI #021: 白蓮 (Byakuren)",
          description_en: "Byakuren exemplifies the purity of Japanese tradition through her graceful sword dance.",
          description_ja: "白蓮は和の伝統美と剣舞を体現し、清廉潔白な存在感を放つ。",
          image: "assets/nft21.jpg",
          video: "",
          style_en: "Traditional Elegance",
          style_ja: "伝統美",
          method_en: "Japanese Sword Dance",
          method_ja: "和の剣舞",
          accessory_en: "Elegant Sword",
          accessory_ja: "優雅な剣",
          collection: "MIYABI",
          traits: {
            personality_en: "Noble & Pure",
            personality_ja: "気高く純粋",
            specialty_en: "Traditional Beauty",
            specialty_ja: "伝統美",
            currentBase_en: "Royal Capital",
            currentBase_ja: "王都",
            fourCharacterIdiom_en: "Seiren Keppaku",
            fourCharacterIdiom_ja: "清廉潔白"
          }
        },
        {
          id: 22,
          title: "MIYABI #022: 仮面 (Kamen)",
          description_en: "Kamen is a mysterious artist specializing in mask crafting and secret techniques.",
          description_ja: "仮面は謎多き流浪の芸術家で、面打ちと秘術を極めている。",
          image: "assets/nft22.jpg",
          video: "",
          style_en: "Mystery & Illusion",
          style_ja: "神秘と幻影",
          method_en: "Mask Craft & Secret Arts",
          method_ja: "面打ちと秘術の融合",
          accessory_en: "Intricate Mask",
          accessory_ja: "精巧な仮面",
          collection: "MIYABI",
          traits: {
            personality_en: "Enigmatic & Elusive",
            personality_ja: "謎めいて捉えどころのない",
            specialty_en: "Mask Techniques",
            specialty_ja: "仮面技術",
            currentBase_en: "Shadow World",
            currentBase_ja: "影の世界",
            fourCharacterIdiom_en: "Gen'ei Kisaku",
            fourCharacterIdiom_ja: "幻影奇策"
          }
        },
        {
          id: 23,
          title: "MIYABI #023: 桃華 (Tōka)",
          description_en: "Tōka masters the art of floral and fragrance techniques, capturing seasonal beauty.",
          description_ja: "桃華は花と香りの術を極め、四季の美しさを体現する。",
          image: "assets/nft23.jpg",
          video: "",
          style_en: "Floral Elegance",
          style_ja: "花の優雅さ",
          method_en: "Flower & Fragrance Techniques",
          method_ja: "花と香の技術",
          accessory_en: "Ornate Hairpin",
          accessory_ja: "装飾的な簪",
          collection: "MIYABI",
          traits: {
            personality_en: "Gentle & Resilient",
            personality_ja: "柔らかく芯の強い",
            specialty_en: "Floral Art",
            specialty_ja: "花の芸術",
            currentBase_en: "Aristocratic District",
            currentBase_ja: "貴族の街",
            fourCharacterIdiom_en: "Fūka Setsugetsu",
            fourCharacterIdiom_ja: "風花雪月"
          }
        },
        {
          id: 24,
          title: "MIYABI #024: 黒影 (Kokuei)",
          description_en: "Kokuei, a silent assassin, fuses the arts of shadow and blade with precision.",
          description_ja: "黒影は静かな暗殺者で、影と刃を融合させて正確な攻撃を行う。",
          image: "assets/nft24.jpg",
          video: "",
          style_en: "Shadow Assassin",
          style_ja: "影の暗殺者",
          method_en: "Stealth Blade Techniques",
          method_ja: "隠密な刃技術",
          accessory_en: "Hidden Dagger",
          accessory_ja: "隠し短剣",
          collection: "MIYABI",
          traits: {
            personality_en: "Silent & Deadly",
            personality_ja: "静かで致命的",
            specialty_en: "Shadow & Blade Fusion",
            specialty_ja: "影と刃の融合",
            currentBase_en: "Underworld",
            currentBase_ja: "裏社会",
            fourCharacterIdiom_en: "Ei Bu Senjin",
            fourCharacterIdiom_ja: "影武千刃"
          }
        },
        {
          id: 25,
          title: "MIYABI #025: 月音 (Tsukine)",
          description_en: "Tsukine, an enigmatic musician, bridges heaven and earth with traditional instruments and cosmic harmonies.",
          description_ja: "月音は神秘的な音楽家で、和楽器と宇宙の調和で天と地を繋ぐ。",
          image: "assets/nft25.jpg",
          video: "",
          style_en: "Cosmic Harmony",
          style_ja: "宇宙の調和",
          method_en: "Traditional Instruments x Cosmic Fusion",
          method_ja: "和楽器と宇宙の融合",
          accessory_en: "Celestial Instrument",
          accessory_ja: "天体楽器",
          collection: "MIYABI",
          traits: {
            personality_en: "Mysterious & Harmonious",
            personality_ja: "神秘的で調和の取れた",
            specialty_en: "Musical Fusion",
            specialty_ja: "音楽の融合",
            currentBase_en: "Temple",
            currentBase_ja: "神殿",
            fourCharacterIdiom_en: "Kyōten Rakuen",
            fourCharacterIdiom_ja: "響天楽音"
          }
        },
        {
          id: 26,
          title: "MIYABI #026: 空雅 (Kuuga)",
          description_en: "Kuuga, a silent swordsman of the skies, wields aerial sword techniques with solitary grace.",
          description_ja: "空雅は静かな剣士で、天空の剣技を孤高に極める。",
          image: "assets/nft26.jpg",
          video: "",
          style_en: "Aerial Swordplay",
          style_ja: "空中剣術",
          method_en: "Sky-High Combat",
          method_ja: "天空戦闘",
          accessory_en: "Winged Sword",
          accessory_ja: "翼の剣",
          collection: "MIYABI",
          traits: {
            personality_en: "Silent & Solitary",
            personality_ja: "静かで孤高",
            specialty_en: "Aerial Sword Techniques",
            specialty_ja: "空中剣技",
            currentBase_en: "Above the Clouds",
            currentBase_ja: "雲上",
            fourCharacterIdiom_en: "Tenkū Koei",
            fourCharacterIdiom_ja: "天空孤影"
          }
        },
        {
          id: 27,
          title: "MIYABI #027: 夜鴉 (Yogarasu)",
          description_en: "Yogarasu, the nocturnal guardian, excels in stealth and shadow tactics.",
          description_ja: "夜鴉は夜の守護者として、隠密な戦術と影の技術を極めている。",
          image: "assets/nft27.jpg",
          video: "",
          style_en: "Nocturnal Tactics",
          style_ja: "夜の戦術",
          method_en: "Stealth & Shadow",
          method_ja: "隠密と影",
          accessory_en: "Crescent Dagger",
          accessory_ja: "三日月の短剣",
          collection: "MIYABI",
          traits: {
            personality_en: "Vigilant & Stealthy",
            personality_ja: "警戒心が強く隠密",
            specialty_en: "Night Tactics",
            specialty_ja: "夜間戦術",
            currentBase_en: "Dark Market",
            currentBase_ja: "闇市場",
            fourCharacterIdiom_en: "Ei Jū Yahi",
            fourCharacterIdiom_ja: "影従夜飛"
          }
        },
        {
          id: 28,
          title: "MIYABI #028: 狂華 (Kyōka)",
          description_en: "Kyōka merges beauty with madness, creating mask dances and labyrinthine illusions.",
          description_ja: "狂華は美と狂気を融合させ、仮面舞踏と幻影で混沌を表現する。",
          image: "assets/nft28.jpg",
          video: "",
          style_en: "Mad Artistic Expression",
          style_ja: "狂気の芸術表現",
          method_en: "Mask Dance + Illusory Techniques",
          method_ja: "仮面舞踏と幻影技術の融合",
          accessory_en: "Decorative Mask",
          accessory_ja: "装飾的な仮面",
          collection: "MIYABI",
          traits: {
            personality_en: "Elegant & Unhinged",
            personality_ja: "優雅で奔放",
            specialty_en: "Art & Illusion",
            specialty_ja: "芸術と幻影",
            currentBase_en: "Masked Theatre",
            currentBase_ja: "仮面劇場",
            fourCharacterIdiom_en: "Gakyō Kenran",
            fourCharacterIdiom_ja: "雅狂絢爛"
          }
        },
        {
          id: 29,
          title: "MIYABI #029: 冥 (Mei)",
          description_en: "Mei, the embodiment of calm rationality, shuns the superfluous and follows the most efficient path. Once a guardian, he now roams as a mercenary fusing ancient martial arts with futuristic tech.",
          description_ja: "冥は冷静な合理主義者。無駄を排し最短の道を選び、かつての守護者から伝統武術と近未来技術を融合する傭兵となる。",
          image: "assets/nft29.jpg",
          video: "",
          style_en: "Futuristic Warrior",
          style_ja: "近未来戦士",
          method_en: "Traditional Martial Arts + Future Tech",
          method_ja: "伝統武術と未来技術の融合",
          accessory_en: "Battle Umbrella",
          accessory_ja: "戦闘用傘",
          collection: "MIYABI",
          traits: {
            personality_en: "Calm & Efficient",
            personality_ja: "冷静で効率的",
            specialty_en: "Hybrid Combat",
            specialty_ja: "混合戦闘",
            currentBase_en: "Global Mercenary",
            currentBase_ja: "世界中の傭兵",
            fourCharacterIdiom_en: "Denkō Eiri",
            fourCharacterIdiom_ja: "電光影裏"
          }
        },
        {
          id: 30,
          title: "MIYABI #030: 千早 (Chihaya)",
          description_en: "Chihaya, a noble warrior with a graceful facade and burning passion, leads the secret 'Senya-kai' in the royal capital.",
          description_ja: "千早は高貴で優雅な戦士。内に燃える情熱を秘め、王都で秘密結社『千夜会』を率いている。",
          image: "assets/nft30.jpg",
          video: "",
          style_en: "Elegant Warrior",
          style_ja: "優雅な戦士",
          method_en: "Dance Sword Technique + Illusion",
          method_ja: "舞踏剣術と幻影術の融合",
          accessory_en: "Battle Fan",
          accessory_ja: "戦扇",
          collection: "MIYABI",
          traits: {
            personality_en: "Noble & Passionate",
            personality_ja: "気高く情熱的",
            specialty_en: "Sword Dance & Illusion",
            specialty_ja: "剣舞と幻影",
            currentBase_en: "Royal Capital",
            currentBase_ja: "王都",
            fourCharacterIdiom_en: "Enshi Giga",
            fourCharacterIdiom_ja: "艶姿戯画"
          }
        }
      ];

      // NFT Detail Modal 関連処理
      function openModal(nft) {
          const modal = document.getElementById('nftModal');
          if (!modal) return;
          const modalImg = document.getElementById('modalImage');
          const modalVideo = document.getElementById('modalVideo');
          const modalInfo = document.querySelector('.modal-info');
          const modalContent = document.querySelector('.modal-content');
          // 初期状態：画像＋詳細情報表示、動画は非表示
          modalImg.style.display = 'block';
          modalVideo.style.display = 'none';
          if(modalInfo) {
            modalInfo.style.display = '';
          }
          modalContent.classList.remove('video-active');

          modalImg.src = nft.image;
          modalImg.alt = nft.title;
          if(nft.video) {
            modalVideo.src = nft.video;
          } else {
            modalVideo.src = "";
          }
          const modalCollectionElem = document.getElementById('modalCollection');
          const modalNumberElem = document.getElementById('modalNumber');
          if (modalCollectionElem) {
              modalCollectionElem.textContent = nft.collection ? nft.collection.toUpperCase() : 'MIYABI';
          }
          if (modalNumberElem) {
              modalNumberElem.textContent = "#" + String(nft.id).padStart(4, '0');
          }
          document.getElementById('modalTitle').textContent = nft.title;
          // 説明文、style, method, accessory は現在の言語に応じて
          document.getElementById('modalDescription').textContent = nft["description_" + currentLang];
          document.getElementById('modalStyle').textContent = nft["style_" + currentLang] || nft.style;
          document.getElementById('modalMethod').textContent = nft["method_" + currentLang] || nft.method;
          document.getElementById('modalAccessory').textContent = nft["accessory_" + currentLang] || nft.accessory;
          updateTraits(nft);
          
          // 画像読み込み後、背景色抽出（Color Thief利用例）
          modalImg.onload = function() {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              canvas.width = modalImg.width;
              canvas.height = modalImg.height;
              ctx.drawImage(modalImg, 0, 0);
              const imageData = ctx.getImageData(0, 0, 1, 1).data;
              const bgColor = "rgb(" + imageData[0] + ", " + imageData[1] + ", " + imageData[2] + ")";
              const modalBg = document.querySelector('.modal-background');
              if (modalBg) {
                  modalBg.style.backgroundColor = bgColor;
              }
              if (window.innerWidth <= 768) {
                  const modalOverlay = document.querySelector('.modal-overlay');
                  if (modalOverlay) {
                      modalOverlay.style.backgroundColor = bgColor;
                  }
              }
          };

          // 画像クリックで動画表示（動画が存在する場合）
          modalImg.onclick = function() {
            if(nft.video && modalVideo.src) {
              modalImg.style.display = 'none';
              modalVideo.style.display = 'block';
              if(modalInfo) {
                modalInfo.style.display = 'none';
              }
              modalContent.classList.add('video-active');
              modalVideo.play();
            }
          };
          // 動画クリックで画像＋詳細情報表示に戻す
          modalVideo.onclick = function() {
            modalVideo.pause();
            modalVideo.style.display = 'none';
            modalImg.style.display = 'block';
            if(modalInfo) {
              modalInfo.style.display = '';
            }
            modalContent.classList.remove('video-active');
          };

          modal.style.display = 'flex';
          setTimeout(() => { modal.classList.add('active'); }, 10);
          document.body.style.overflow = 'hidden';
          setupModalEventListeners(modal);
      }
      function updateTraits(nft) {
          const modalTraits = document.getElementById('modalTraits');
          if (modalTraits && nft.traits) {
              const keysToShow = ["personality", "specialty", "currentBase", "fourCharacterIdiom"];
              let traitsHTML = '<h3>' + (translations[currentLang].traitsTitle || "Traits") + '</h3><div class="trait-list">';
              keysToShow.forEach(key => {
                  if(nft.traits[key + "_" + currentLang]){
                    traitsHTML += 
                      '<div class="trait-item">' +
                          '<span class="trait-type">' + getTraitLabel(key) + ':</span> ' +
                          '<span class="trait-value">' + nft.traits[key + "_" + currentLang] + '</span>' +
                      '</div>';
                  }
              });
              traitsHTML += '</div>';
              modalTraits.innerHTML = traitsHTML;
          } else if (modalTraits) {
              modalTraits.innerHTML = '';
          }
      }
      function getTraitLabel(key) {
          const labels = {
              personality: currentLang === "ja" ? "性格" : "Personality",
              specialty: currentLang === "ja" ? "専門" : "Specialty",
              currentBase: currentLang === "ja" ? "活動拠点" : "Base",
              fourCharacterIdiom: currentLang === "ja" ? "四字熟語" : "Idiom"
          };
          return labels[key] || key;
      }
      function setupModalEventListeners(modal) {
          const closeButton = modal.querySelector('.modal-close');
          if (closeButton) {
              closeButton.addEventListener('touchstart', (e) => {
                  e.preventDefault();
              });
              closeButton.addEventListener('touchend', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  closeModal();
              });
              closeButton.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  closeModal();
              });
          }
          modal.addEventListener('click', (e) => {
              if (e.target === modal) {
                  closeModal();
              }
          });
          const escHandler = (e) => {
              if (e.key === 'Escape') {
                  closeModal();
              }
          };
          document.addEventListener('keydown', escHandler);
          modal._escHandler = escHandler;
      }
      function closeModal() {
          const modal = document.getElementById('nftModal');
          if (!modal) return;
          if (modal._escHandler) {
              document.removeEventListener('keydown', modal._escHandler);
              delete modal._escHandler;
          }
          modal.classList.remove('active');
          setTimeout(() => {
              modal.style.display = 'none';
              document.body.style.overflow = '';
          }, 300);
      }
      function populateGallery() {
          const galleryGrid = document.querySelector('.gallery-grid');
          if (!galleryGrid) return;
          galleryGrid.innerHTML = '';
          nftData.forEach(nft => {
              const item = createGalleryItem(nft);
              galleryGrid.appendChild(item);
          });
      }
      function createGalleryItem(nft) {
          const item = document.createElement('div');
          item.className = 'gallery-item';
          item.dataset.number = "#" + String(nft.id).padStart(4, '0');
          item.dataset.title = nft.title;
          const numberDiv = document.createElement('div');
          numberDiv.className = 'gallery-item-number';
          numberDiv.textContent = item.dataset.number;
          const img = document.createElement('img');
          img.src = nft.image;
          img.alt = nft.title;
          img.loading = 'lazy';
          img.onerror = function() {
              this.src = 'assets/placeholder.jpg';
          };
          item.appendChild(numberDiv);
          item.appendChild(img);
          item.addEventListener('click', () => {
              openModal(nft);
          });
          return item;
      }
      async function initializeWeb3() {
          if (typeof window.ethereum !== 'undefined') {
              window.web3 = new Web3(window.ethereum);
              const connectBtn = document.querySelector('.connect-btn');
              if (connectBtn) {
                  connectBtn.addEventListener('click', connectWallet);
              }
              window.ethereum.on('accountsChanged', handleAccountsChanged);
          }
      }
      async function connectWallet() {
          try {
              const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
              handleAccountsChanged(accounts);
          } catch (error) {
              console.error('Failed to connect wallet:', error);
          }
      }
      function handleAccountsChanged(accounts) {
          const connectBtn = document.querySelector('.connect-btn');
          if (!connectBtn) return;
          if (accounts.length === 0) {
              connectBtn.textContent = translations[currentLang].connectWallet;
          } else {
              const shortAddress = accounts[0].substring(0, 6) + "..." + accounts[0].substring(accounts[0].length - 4);
              connectBtn.textContent = shortAddress;
          }
      }
      function initializeLanguageToggle() {
          const langSelect = document.querySelector('.lang-select');
          if (langSelect) {
              langSelect.addEventListener('change', (e) => {
                  currentLang = e.target.value;
                  updateLanguage();
              });
              langSelect.addEventListener('input', (e) => {
                  currentLang = e.target.value;
                  updateLanguage();
              });
          }
          updateLanguage();
      }
      function updateLanguage() {
          // data-translate属性を持つ要素の更新
          document.querySelectorAll('[data-translate]').forEach(element => {
              const key = element.dataset.translate;
              const translationPath = key.split('.');
              let translation = translations[currentLang];
              for (const path of translationPath) {
                  translation = translation?.[path];
              }
              if (translation) {
                  element.textContent = translation;
              }
          });
          const searchInput = document.querySelector('.search-input');
          if (searchInput) {
              searchInput.placeholder = translations[currentLang].search;
          }
          const connectBtn = document.querySelector('.connect-btn');
          if (connectBtn && !connectBtn.textContent.includes('0x')) {
              connectBtn.textContent = translations[currentLang].connectWallet;
          }
          // モーダル内表示中の場合、説明文・詳細情報および特性を更新
          const modalTitle = document.getElementById('modalTitle');
          if (modalTitle && modalTitle.textContent) {
              const nft = nftData.find(nft => nft.title === modalTitle.textContent);
              if (nft) {
                  document.getElementById('modalDescription').textContent = nft["description_" + currentLang];
                  document.getElementById('modalStyle').textContent = nft["style_" + currentLang] || nft.style;
                  document.getElementById('modalMethod').textContent = nft["method_" + currentLang] || nft.method;
                  document.getElementById('modalAccessory').textContent = nft["accessory_" + currentLang] || nft.accessory;
                  updateTraits(nft);
              }
          }
      }
      function isMobileDevice() {
          return window.innerWidth <= 768;
      }
      function optimizeForMobile() {
          if (isMobileDevice()) {
              const galleryGrid = document.querySelector('.gallery-grid');
              if (galleryGrid) {
                  // モバイル時は1列表示に変更
                  galleryGrid.style.gridTemplateColumns = '1fr';
              }
              const modalContent = document.querySelector('.nft-modal .modal-content');
              if (modalContent) {
                  modalContent.style.gridTemplateColumns = '1fr';
              }
          }
      }
      function debounce(func, wait) {
          let timeout;
          return function(...args) {
              clearTimeout(timeout);
              timeout = setTimeout(() => func(...args), wait);
          };
      }
      function lazyLoadImages() {
          const images = document.querySelectorAll('img[data-src]');
          const imageObserver = new IntersectionObserver((entries, observer) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      const img = entry.target;
                      img.src = img.dataset.src;
                      img.removeAttribute('data-src');
                      observer.unobserve(img);
                  }
              });
          });
          images.forEach(img => imageObserver.observe(img));
      }
      function handleError(error, context) {
          console.error("Error in " + context + ":", error);
          const errorContainer = document.querySelector('.error-container');
          if (errorContainer) {
              errorContainer.textContent = (currentLang === "ja" ? "エラーが発生しました: " : "An error occurred: ") + error.message;
              errorContainer.style.display = 'block';
          }
      }
      try {
          populateGallery();
          initializeLanguageToggle();
          initializeWeb3();
          optimizeForMobile();
          lazyLoadImages();
          window.addEventListener('resize', debounce(() => {
              optimizeForMobile();
          }, 250));
      } catch (error) {
          handleError(error, 'application initialization');
      }
    });
  </script>
</body>
</html>
